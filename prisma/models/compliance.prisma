model ConsentVersion {
  id            String       @id @default(uuid()) 
  clinicId      String?      
  type          ConsentType?
  version       String?     
  title         String?     
  body          String?      
  effectiveDate DateTime?    
  createdAt     DateTime?    @default(now())  

  clinic          Clinic?          @relation(fields: [clinicId], references: [id])
  patientConsents PatientConsent[]

  @@map("consent_versions")
}

model PatientConsent {
  id               String       @id @default(uuid()) 
  patientId        String?       
  consentVersionId String?      
  type             ConsentType?
  given            Boolean?
  givenAt          DateTime?    
  withdrawnAt      DateTime?    
  ip               String?      
  userAgent        String?      
  createdAt        DateTime?    @default(now()) 
  updatedAt        DateTime?    @updatedAt 

  patient        Patient?        @relation(fields: [patientId], references: [id])
  consentVersion ConsentVersion? @relation(fields: [consentVersionId], references: [id])

  @@map("patient_consents")
}

model KeyManagement {
  id        String    @id @default(uuid()) 
  version   String?   @unique
  dekCipher Bytes?   
  createdAt DateTime? @default(now()) 
  rotatedAt DateTime?  

  @@map("key_managements")
}

model AuditLog {
  id         String    @id @default(uuid()) 
  table      String?  
  rowId      String?    
  action     String?  
  oldValues  Json?     
  newValues  Json?     
  
  // Can be triggered by Admin or Doctor
  adminId    String?   
  doctorId   String?    
  
  clinicId   String?    
  ip         String?   
  userAgent  String?   
  occurredAt DateTime? 

  clinic Clinic? @relation(fields: [clinicId], references: [id])
  admin  Admin?  @relation(fields: [adminId], references: [id])
  doctor Doctor? @relation(fields: [doctorId], references: [id])

  @@map("audit_logs")
}

model DataRequest {
  id                String             @id @default(uuid()) 
  clinicId          String?            
  patientId         String?            
  type              DataRequestType?
  status            DataRequestStatus?
  requestReason     String?           
  requestedAt       DateTime?          
  completedAt       DateTime?          
  downloadUrl       String?            
  downloadExpiresAt DateTime?          

  clinic  Clinic?  @relation(fields: [clinicId], references: [id])
  patient Patient? @relation(fields: [patientId], references: [id])

  @@map("data_requests")
}
model Admin {
  id           String  @id @default(uuid()) 
  clinicId     String?  
  email        String @unique 
  passwordHash String? 
  firstName    String? 
  lastName     String?  
  photo        String? 
  otp          String?
   otpExpiresAt DateTime? 


  emailVerifiedAt  DateTime?  
  twoFactorSecret  String?   
  twoFactorEnabled Boolean?  
  lastLoginAt      DateTime? 
  createdAt        DateTime? @default(now()) 
  updatedAt        DateTime? @updatedAt 
  deletedAt        DateTime?  

  // Relations
  clinic        Clinic?    @relation(fields: [clinicId], references: [id])
  sessions      Session[]
  auditLogs     AuditLog[]
  assignedTasks Task[]     @relation("AdminTaskAssignee")
  passwordResets PasswordReset[]

  @@map("admins")
}

model Doctor {
  id           String  @id @default(uuid()) 
  clinicId     String? 
  email        String? @unique 
  passwordHash String? 
  firstName    String? 
  lastName     String? 
  otp          String?
   otpExpiresAt DateTime? 

  // Doctor Specific Fields
  licenceNo    String?  
  specialities String[] 

  emailVerifiedAt  DateTime? 
  twoFactorSecret  String?   
  twoFactorEnabled Boolean?  
  lastLoginAt      DateTime? 
  createdAt        DateTime? @default(now()) 
  updatedAt        DateTime? @updatedAt 
  deletedAt        DateTime?  

  // Relations
  clinic        Clinic?        @relation(fields: [clinicId], references: [id])
  sessions      Session[]
  appointments  Appointment[]  @relation("DoctorAppointments")
  calls         Call[]         @relation("DoctorCalls")
  prescriptions Prescription[] @relation("DoctorPrescriptions")
  diagnoses     Diagnosis[]    @relation("DoctorDiagnoses")
  assignedTasks Task[]         @relation("DoctorTaskAssignee")
  auditLogs     AuditLog[]
  passwordResets PasswordReset[]

  // HR Relations
  staffPersonalInfo   StaffPersonalInfo?
  staffEmploymentInfo StaffEmploymentInfo?

  // Self-relation for reporting hierarchy
  subordinates StaffEmploymentInfo[] @relation("ReportingManager")

  @@map("doctors")
}

model Session {
  id       String  @id @default(uuid()) 
  adminId  String? 
  doctorId String?  

  accessToken  String @unique
  refreshToken String @unique

  isActive  Boolean   @default(true)
  isRevoked Boolean   @default(false)
  revokedAt DateTime?

  lastActivity          DateTime @default(now())
  refreshTokenExpiresAt DateTime

  createdAt DateTime? @default(now()) 
  updatedAt DateTime  @updatedAt

  admin  Admin?  @relation(fields: [adminId], references: [id])
  doctor Doctor? @relation(fields: [doctorId], references: [id])

  @@map("sessions")
}

model PasswordReset {
  id        String   @id @default(uuid())
  email     String
  otp       String
  token     String?  @unique 
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime @default(now())
  
  // Relation to track which user
  adminId  String?
  doctorId String?
  
  admin  Admin?  @relation(fields: [adminId], references: [id])
  doctor Doctor? @relation(fields: [doctorId], references: [id])
  
  @@map("password_resets")
}
model Admin {
  id           String  @id @default(uuid())
  email        String  @unique
  passwordHash String?
  firstName    String?
  lastName     String?
  photo        String?

  emailVerifiedAt  DateTime?
  twoFactorSecret  String?
  twoFactorEnabled Boolean?
  lastLoginAt      DateTime?
  createdAt        DateTime? @default(now())
  updatedAt        DateTime? @updatedAt
  deletedAt        DateTime?

  // Relations
  sessions       Session[]
  auditLogs      AuditLog[]
  passwordResets PasswordReset[]
  user           User?

  @@map("admins")
}

model Doctor {
  id           String  @id @default(uuid())
  email        String? @unique
  phone        String? @unique
  passwordHash String?
  firstName    String?
  lastName     String?

  // Doctor Specific Fields
  licenceNo    String?
  specialities String[]
  experience   String?

  emailVerifiedAt  DateTime?
  dob              DateTime?
  photo            String?
  gender           Gender?
  address          String?
  twoFactorSecret  String?
  twoFactorEnabled Boolean?
  lastLoginAt      DateTime?
  createdAt        DateTime? @default(now())
  updatedAt        DateTime? @updatedAt
  deletedAt        DateTime?

  // Relations
  sessions       Session[]
  appointments   Appointment[]   @relation("DoctorAppointments")
  calls          Call[]          @relation("DoctorCalls")
  prescriptions  Prescription[]  @relation("DoctorPrescriptions")
  labs           Lab[]           @relation("DoctorLabs")
  diagnoses      Diagnosis[]     @relation("DoctorDiagnoses")
  auditLogs      AuditLog[]
  passwordResets PasswordReset[]
  user           User?

  staff Staff[]

  weeklySchedules DoctorWeeklySchedule[]

  // Settings Relations
  doctorNotificationSettings DoctorNotificationSettings?
  doctorRegionalSettings     DoctorRegionalSettings?
  doctorSecuritySettings     DoctorSecuritySettings?

  // Subscription Relation
  subscription Subscription?
  // AI Agent Relations
  callTranscriptions CallTranscription[] @relation("DoctorCallTranscriptions")
  knowledgeBase      DoctorKnowledgeBase[] @relation("DoctorKnowledgeBase")

  @@map("doctors")
}

model Session {
  id       String  @id @default(uuid())
  adminId  String?
  doctorId String?

  accessToken  String @unique
  refreshToken String @unique

  isActive  Boolean   @default(true)
  isRevoked Boolean   @default(false)
  revokedAt DateTime?

  lastActivity          DateTime @default(now())
  refreshTokenExpiresAt DateTime

  createdAt DateTime? @default(now())
  updatedAt DateTime  @updatedAt

  admin  Admin?  @relation(fields: [adminId], references: [id])
  doctor Doctor? @relation(fields: [doctorId], references: [id])

  @@map("sessions")
}

model PasswordReset {
  id         String    @id @default(uuid())
  email      String
  otp        String
  token      String?   @unique
  expiresAt  DateTime
  verifiedAt DateTime?
  usedAt     DateTime?
  createdAt  DateTime  @default(now())

  // Relation to track which user
  adminId  String?
  doctorId String?

  admin  Admin?  @relation(fields: [adminId], references: [id])
  doctor Doctor? @relation(fields: [doctorId], references: [id])

  @@map("password_resets")
}

// Unified User model for chat
model User {
  id        String   @id @default(uuid())
  adminId   String?  @unique
  doctorId  String?  @unique
  role      UserRole
  
  admin     Admin?   @relation(fields: [adminId], references: [id])
  doctor    Doctor?  @relation(fields: [doctorId], references: [id])
  
  // Conversations where this user is the participant
  conversations      AdminConversation[] @relation("UserConversations")
  // Conversations where this user is the admin
  adminConversations AdminConversation[] @relation("AdminConversations")
  sentMessages       SupportMessage[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("users")
}

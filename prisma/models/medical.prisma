// prisma/models/medical.prisma
model Appointment {
  id        String             @id @default(uuid()) @db.Uuid
  clinicId  String?            @map("clinic_id") @db.Uuid
  patientId String?            @map("patient_id") @db.Uuid
  doctorId  String?            @map("doctor_id") @db.Uuid
  startAt   DateTime?          @map("start_at") @db.Timestamptz(6)
  endAt     DateTime?          @map("end_at") @db.Timestamptz(6)
  status    AppointmentStatus?
  note      String?            @db.Text
  createdAt DateTime?          @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime?          @updatedAt @map("updated_at") @db.Timestamp(6)
  deletedAt DateTime?          @map("deleted_at") @db.Timestamp(6)

  clinic  Clinic?  @relation(fields: [clinicId], references: [id])
  patient Patient? @relation(fields: [patientId], references: [id])
  doctor  Doctor?  @relation("DoctorAppointments", fields: [doctorId], references: [id])

  @@map("appointments")
}

model Call {
  id                 String      @id @default(uuid()) @db.Uuid
  clinicId           String?     @map("clinic_id") @db.Uuid
  patientId          String?     @map("patient_id") @db.Uuid
  doctorId           String?     @map("doctor_id") @db.Uuid
  startAt            DateTime?   @map("start_at") @db.Timestamptz(6)
  endAt              DateTime?   @map("end_at") @db.Timestamptz(6)
  durationSeconds    Int?        @map("duration_seconds")
  status             CallStatus?
  recordingUrlCipher String?     @map("recording_url_cipher") @db.VarChar
  transcript         String?     @db.Text
  aiSummary          String?     @map("ai_summary") @db.Text
  sentiment          Sentiment?
  escalated          Boolean?
  minutesUsed        Int?        @map("minutes_used")
  createdAt          DateTime?   @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt          DateTime?   @updatedAt @map("updated_at") @db.Timestamp(6)
  aiModelId          String?     @map("ai_model_id") @db.Uuid
  aiDecision         String?     @map("ai_decision") @db.VarChar

  clinic  Clinic?  @relation(fields: [clinicId], references: [id])
  patient Patient? @relation(fields: [patientId], references: [id])
  doctor  Doctor?  @relation("DoctorCalls", fields: [doctorId], references: [id])

  @@map("calls")
}

model Diagnosis {
  id            String    @id @default(uuid()) @db.Uuid
  patientId     String?   @map("patient_id") @db.Uuid
  doctorId      String?   @map("doctor_id") @db.Uuid
  diagnosisCode String?   @map("diagnosis_code") @db.VarChar
  diagnosisName String?   @map("diagnosis_name") @db.VarChar
  description   String?   @db.Text
  status        String?   @db.VarChar
  diagnosedDate DateTime? @map("diagnosed_date") @db.Date
  resolvedDate  DateTime? @map("resolved_date") @db.Date
  createdAt     DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime? @updatedAt @map("updated_at") @db.Timestamp(6)

  patient Patient? @relation(fields: [patientId], references: [id])
  doctor  Doctor?  @relation("DoctorDiagnoses", fields: [doctorId], references: [id])

  @@map("diagnoses")
}

model Lab {
  id           String    @id @default(uuid()) @db.Uuid
  clinicId     String?   @map("clinic_id") @db.Uuid
  patientId    String?   @map("patient_id") @db.Uuid
  testDate     DateTime? @map("test_date") @db.Date
  pdfKeyCipher String?   @map("pdf_key_cipher") @db.VarChar
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt    DateTime? @updatedAt @map("updated_at") @db.Timestamp(6)
  deletedAt    DateTime? @map("deleted_at") @db.Timestamp(6)

  clinic  Clinic?  @relation(fields: [clinicId], references: [id])
  patient Patient? @relation(fields: [patientId], references: [id])
  results LabResult[]

  @@map("labs")
}

model LabResult {
  id        String  @id @default(uuid()) @db.Uuid
  labId     String? @map("lab_id") @db.Uuid
  testName  String? @map("test_name") @db.VarChar
  result    String? @db.VarChar
  unit      String? @db.VarChar
  normalMin Float?  @map("normal_min")
  normalMax Float?  @map("normal_max")
  flag      Flag?

  lab Lab? @relation(fields: [labId], references: [id])

  @@map("lab_results")
}

model Prescription {
  id             String              @id @default(uuid()) @db.Uuid
  clinicId       String?             @map("clinic_id") @db.Uuid
  patientId      String?             @map("patient_id") @db.Uuid
  doctorId       String?             @map("doctor_id") @db.Uuid
  prescriptionNo Int?                @map("prescription_no")
  status         PrescriptionStatus?
  createdAt      DateTime?           @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt      DateTime?           @updatedAt @map("updated_at") @db.Timestamp(6)
  deletedAt      DateTime?           @map("deleted_at") @db.Timestamp(6)

  clinic    Clinic?                @relation(fields: [clinicId], references: [id])
  patient   Patient?               @relation(fields: [patientId], references: [id])
  doctor    Doctor?                @relation("DoctorPrescriptions", fields: [doctorId], references: [id])
  medicines PrescriptionMedicine[]

  @@map("prescriptions")
}

model PrescriptionMedicine {
  id             String  @id @default(uuid()) @db.Uuid
  prescriptionId String? @map("prescription_id") @db.Uuid
  medicine       String? @db.VarChar
  strength       String? @db.VarChar
  dose           String? @db.VarChar
  frequency      String? @db.VarChar
  route          String? @db.VarChar
  duration       String? @db.VarChar
  refill         Int?

  prescription Prescription? @relation(fields: [prescriptionId], references: [id])

  @@map("prescription_medicines")
}